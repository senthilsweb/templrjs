---
title: Database Model
description: Templr DB model and relationship
tags: []
---

Supabase database comes with set of preloaded schemas and the main ones are below. All of the schemas other than `public` are reserved for supabase to operate and to store their metadata. 

---

## Supabase Database Schemas

![image info](/docs/supabase-schemas.svg)

## Templr Data model

Templr/custom application specific database objects a.k.a entities will be created within the `public` schema. In-order for Templr to works, it comes with a minimal set of database `views`,`functions` and `tables`. The tables are populated with configuration seed data during initialization i.e. post installation [^2] or application bootstapping [^3]

![image info](/docs/zytes_default_db_tables.svg)

## Templr DB objects


Following are the default mimal set of database objects that are must for zytes to work.

**Name**                  | **Object Type**                     | **Description**                     
------------------------------|:-----------------------------------:|---------------------------------------------                  
 properties                   |    :badge[table]                    |  Custom configurations as key-value pairs. This can be nested for parent/child relationships                                           
 navigation                   |    :badge[table]                    |  Application wide navigations. This can be nested for parent/child relationships                                                                                         
 inquiries                    |    :badge[table]                    |  To store any online inquiries received for review and actions.                                            
 vw_meta_column               |    :badge[view]{type="warning"}     |                                              
 vw_tables_and_views          |    :badge[view]{type="warning"}     |                                              
 vw_navigation                |    :badge[view]{type="warning"}     |                                              
 get_parent_navigations       |    :badge[function]{type="danger"}  |                                              
 get_child_navigations        |    :badge[function]{type="danger"}  |                                              



## Templr table template

The Database tables in the `Templr` DB must have the following fields with the datatype and constraints as men tioned in the below list and highlighted in a red box in the supporting diagram.


::list
- id  `BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY`
- {...application specific fields}
- additional_attributes jsonb
- tenant CHARACTER varying
- is_active   BOOLEAN DEFAULT TRUE
- is_archived BOOLEAN DEFAULT FALSE
- update_count bigint
- created_by CHARACTER varying
- updated_by CHARACTER varying
- created_at timestamp(6) WITH TIME zone DEFAULT now()
- updated_at timestamp(6) WITH TIME zone DEFAULT now()
- PRIMARY KEY (id)
::

![image info](/docs/zytes.db-tables-design.png)

## PostgreSQL Tables

`SQL` scripts to create core `tables` 

### properties

```sql
CREATE TABLE properties
    (
        id  BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY, 
        code CHARACTER varying DEFAULT ''::CHARACTER varying NOT NULL,
        name CHARACTER varying NOT NULL,
        parent_code CHARACTER varying,
        description CHARACTER varying,
        additional_attributes jsonb,
        tenant CHARACTER varying,
        is_active   BOOLEAN DEFAULT TRUE,
        is_archived BOOLEAN DEFAULT FALSE,
        update_count bigint,
        created_by CHARACTER varying,
        updated_by CHARACTER varying,
        created_at timestamp(6) WITH TIME zone DEFAULT now(),
        updated_at timestamp(6) WITH TIME zone DEFAULT now(),
        PRIMARY KEY (id),
        CONSTRAINT uc__properties__code__parent_code UNIQUE (code, parent_code)
    );
```

### navigation

```sql

CREATE TABLE navigation
    (
        id  BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY, 
        code CHARACTER varying,
        parent_code CHARACTER varying,
        name CHARACTER varying NOT NULL,
        description CHARACTER varying,
        icon CHARACTER varying,
        href CHARACTER varying,
        iconforeground TEXT,
        iconbackground TEXT,
        click_event TEXT,
        tenant_code TEXT,
        is_active        BOOLEAN DEFAULT TRUE,
        is_action_button BOOLEAN DEFAULT FALSE,
        nav_module_code TEXT,
        sort_order            SMALLINT,
        is_footer_description BOOLEAN DEFAULT FALSE,
        css_class TEXT,
        PRIMARY KEY (id),
        CONSTRAINT uc_navigation_code_parent_code UNIQUE (code, parent_code)
    );
```

### company

```sql
CREATE TABLE 
    company 
    ( 
        id           BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY, 
        code         TEXT NOT NULL, 
        company_name    TEXT, 
        tin_ein_number  TEXT, 
        date_of_incorporation   TIMESTAMP(6) WITH TIME ZONE, 
        country_of_incorporation TEXT, 
        company_website      TEXT, 
        company_email        TEXT, 
        logo_url TEXT,
        phone_number TEXT,
        address JSONB,
        description  TEXT, 
        tenant       TEXT,
        additional_attributes JSONB,
        is_active    BOOLEAN DEFAULT true, 
        is_archived  BOOLEAN DEFAULT false, 
        created_by   TEXT, 
        updated_by   TEXT, 
        created_at   TIMESTAMP(6) WITH TIME ZONE DEFAULT now(), 
        updated_at   TIMESTAMP(6) WITH TIME ZONE DEFAULT now(), 
        update_count BIGINT,  
        PRIMARY KEY (id) 
    );
 
COMMENT ON TABLE company IS 'Company or Organization';
```

### inquiries

```sql
CREATE TABLE inquiries
    (
        id  BIGINT NOT NULL generated BY DEFAULT AS identity,
        created_at timestamp(6) WITH TIME zone DEFAULT now(),
        name text NOT NULL,
        phone_number text,
        company_name text,
        inquiry_reason text,
        description text NOT NULL,
        tenant text,
        email text,
        PRIMARY KEY (id)
    );
COMMENT ON TABLE inquiries IS 'Recordings of anonymous enquires sent thru contact form';
```

### country

```sql
CREATE TABLE IF NOT EXISTS country 
    (
        id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY, 
        code char(2) NOT NULL,
        name_caps varchar(80) NOT NULL,
        name varchar(80) NOT NULL,
        iso3 char(3) DEFAULT NULL,
        numcode smallint DEFAULT NULL,
        phonecode int NOT NULL,
        PRIMARY KEY (id)
    );
```

## PostgreSQL Triggers

`SQL` scripts to create core `triggers`

### on_auth_user_created

This trigger is used to create a new user profile in the `profiles` table when a new user is created in the `auth` database. This is done by creating a trigger on the `users` table in the `auth` database.

```SQL
CREATE TRIGGER "on_auth_user_created"
  AFTER INSERT ON users
  FOR EACH ROW
EXECUTE FUNCTION handle_new_user()
```

::alert{type="info"}
Make sure to run this script in the `auth`
::

## PostgreSQL Functions

`SQL` scripts to create core `function` 

### handle_new_user

This function is used to create a new user profile in the `profiles` table when a new user is created in the `auth` database. This is done by creating a trigger on the `users` table in the `auth` database. 


```sql
CREATE FUNCTION handle_new_user ()  RETURNS trigger
  VOLATILE
  SECURITY DEFINER
AS $body$
begin
  insert into public.profiles (id, email)
  values (new.id, new.email);
  return new;
end;
$body$ LANGUAGE plpgsql
```


---